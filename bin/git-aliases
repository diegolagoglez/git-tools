#!/bin/bash

source git-tools

check_git_dir

PREFFIX_SYSTEM=^
PREFFIX_GLOBAL=@
PREFFIX_LOCAL=.

function usage {
	echo "git aliases - Tool to show Git aliases - Diego Lago <diego.lago.gonzalez@gmail.com>"
	echo "Usage: git aliases [option]"
	echo "Options:"
	echo "  --system|-s : Shows system-wide aliases."
	echo "  --global|-g : Shows global (user) aliases."
	echo "  --local |-l : Shows local to repository aliases."
	echo "  --help  |-h : Shows this help."
}

function get_preffix() {
	case "$1" in
		system|s)
			echo "$PREFFIX_SYSTEM "
		;;
		global|g)
			echo "$PREFFIX_GLOBAL "
		;;
		local|l)
			echo "$PREFFIX_LOCAL "
		;;
	esac
}

function get_action {
	case "$1" in
		s)
			echo "system"
		;;
		g)
			echo "global"
		;;
		l)
			echo "local"
		;;
		*)
			echo "$1"
		;;
	esac
}

function show_aliases {
	what=$(get_action "$1")
	title="$2"
	command="git config --$what --list"
	#echo $command
	if [ "$title" != "" ]; then
		echo $what:
		preffix="$(get_preffix $what)"
		$command 2>/dev/null | grep '^alias' | sed -e 's/^alias\.//' | while read; do
			echo $REPLY | awk 'BEGIN {FS="="} {print "  "$1" = "$2}'
		done
	else
		$command 2>/dev/null | grep 'alias\.' | sed -e 's/^alias\.//g' | awk 'BEGIN {FS="="} {print $1" = "$2}'
	fi
}

if [ $# == 0 ]; then
	for T in system global local; do
		show_aliases $T yes
	done
	echo
else
	case "$1" in
		--system|--global|--local)
			option=$(echo "$1" | cut -c3-)
			show_aliases "$option"
		;;
		-s|-g|-l)
			option=$(echo "$1" | cut -c2-)
			show_aliases "$option"
		;;
		--help|-h)
			usage
		;;
		*)
			echo "ERROR: Invalid option: $1"
			usage
			exit 1
		;;
	esac
fi
